<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>AIリフレーミング・ラボ — Mind Space Lab</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600&family=Noto+Sans+JP:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {--heading: 'Playfair Display', serif; --body: 'Noto Sans JP', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;}
    body{font-family:var(--body)}
    h1,h2,h3,.font-display{font-family:var(--heading)}
    .card{border:1px solid rgba(15,23,42,.08);background:rgba(255,255,255,.72);backdrop-filter:blur(8px);border-radius:16px;box-shadow:0 10px 30px rgba(15,23,42,.06)}
    .bubble{border:1px solid rgba(15,23,42,.06);border-radius:14px;padding:.8rem 1rem;background:#fff}
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-sky-50 via-white to-slate-50 text-slate-800">
  <header class="sticky top-0 z-30 backdrop-blur supports-[backdrop-filter]:bg-white/50 bg-white/30 border-b border-slate-200/40">
    <div class="mx-auto max-w-4xl px-4 py-3 flex items-center justify-between">
      <a href="../index.html" class="flex items-center gap-3 hover:opacity-80">
        <div class="h-7 w-7 rounded-2xl bg-gradient-to-br from-sky-200/70 via-indigo-200/70 to-cyan-200/70"></div>
        <span id="brand" class="font-medium tracking-wide font-display">Mind Space Lab</span>
      </a>
      <button id="langToggle" class="text-xs px-3 py-1 rounded-full border border-slate-200 hover:bg-white">English</button>
    </div>
  </header>

  <main class="mx-auto max-w-4xl px-4 py-10">
    <h1 class="text-2xl font-semibold font-display" id="title">AIリフレーミング・ラボ</h1>
    <p class="text-slate-600 mt-2" id="lead">考えすぎた思考を、3行で整える。AIが「攻めずに補助線を引く」リフレーム法。</p>

    <section class="card p-5 mt-6">
      <h2 class="font-medium font-display mb-2" id="cardHead">プロンプトカード</h2>
      <pre class="text-sm whitespace-pre-wrap p-3 bg-white/80 rounded-lg border border-slate-200/50" id="promptJa">あなたは私の思考整理のパートナーです。
次の文章を「事実」「解釈」「別の見方」の3行で整理してください。
攻める口調は使わず、静かな文体で。</pre>
      <pre class="text-sm whitespace-pre-wrap p-3 bg-white/80 rounded-lg border border-slate-200/50 mt-3 hidden" id="promptEn">You are my calm thinking partner.
Organize my sentence in three lines:
1) Fact  2) Interpretation  3) Alternative view.
Use a gentle, non-judgmental tone.</pre>
      <p class="text-xs text-slate-500 mt-2" id="cardNote">※ 下の入力欄に悩みを書いて「AIに渡す」を押すと、同等の意図で応答します。</p>
    </section>

    <section class="card p-5 mt-6">
      <div class="flex gap-2 items-end">
        <textarea id="userText" class="flex-1 rounded-lg border border-slate-200 p-3 focus:outline-none focus:ring-2 focus:ring-sky-200" rows="3" placeholder="例）最近、集中できない。"></textarea>
        <button id="sendBtn" class="px-4 py-2 rounded-lg border border-slate-300 hover:bg-white" aria-label="Send">AIに渡す</button>
      </div>
      <div id="chat" class="mt-5 space-y-3"></div>
      <p class="text-[11px] text-slate-500 mt-3" id="privacyLine">このフォームは、サイトのAPIプロキシ（サーバレス）へ送信されます。個人情報は書かないでください。</p>
    </section>

    <section class="mt-8">
      <h3 class="font-medium font-display mb-2" id="exHead">出力イメージ</h3>
      <div class="grid md:grid-cols-2 gap-4">
        <div class="bubble">事実：会議が続いた。<br/>解釈：集中できない自分に不安。<br/>別の見方：休息で精度が戻る。</div>
        <div class="bubble">Fact: Meetings stacked.<br/>Interpretation: Worry about focus.<br/>Alternative view: Rest restores accuracy.</div>
      </div>
    </section>
  </main>

  <footer class="py-10 text-center text-xs text-slate-500" id="footer">© 2025 Mind Space Lab.</footer>

  <script>
    const dict={
      ja:{title:"AIリフレーミング・ラボ",lead:"考えすぎた思考を、3行で整える。AIが「攻めずに補助線を引く」リフレーム法。",cardHead:"プロンプトカード",cardNote:"※ 下の入力欄に悩みを書いて「AIに渡す」を押すと、同等の意図で応答します。",privacyLine:"このフォームは、サイトのAPIプロキシ（サーバレス）へ送信されます。個人情報は書かないでください。",exHead:"出力イメージ",toggle:"English"},
      en:{title:"AI Reframing Lab",lead:"Tidy overthinking into three lines. AI draws gentle helper lines:",cardHead:"Prompt Card",cardNote:"Type your concern below and hit “Send to AI”. The response follows the same intent.",privacyLine:"Your text is sent to a serverless API proxy. Please avoid personal data.",exHead:"Sample output",toggle:"日本語"}
    };
    const $=id=>document.getElementById(id);let lang="ja";
    function t(id,key){ if($(id)) $(id).textContent=dict[lang][key]; }
    function apply(){document.documentElement.lang=lang==='ja'?'ja':'en';t('title','title');t('lead','lead');t('cardHead','cardHead');t('cardNote','cardNote');t('privacyLine','privacyLine');t('exHead','exHead');$('langToggle').textContent=dict[lang].toggle; $('promptJa').classList.toggle('hidden', lang!=='ja'); $('promptEn').classList.toggle('hidden', lang!=='en');}
    apply();$('langToggle').addEventListener('click',()=>{lang=lang==='ja'?'en':'ja';apply();});

    async function sendMessage() {
      const text=$('userText').value.trim();
      if(!text) return;
      $('chat').insertAdjacentHTML('beforeend', `<div class="bubble"><strong>YOU:</strong> ${text.replace(/</g,'&lt;')}</div>`);
      $('userText').value='';
      $('sendBtn').disabled=true; $('sendBtn').textContent='…';
      try{
        const res=await fetch('https://floral-fire-c472.rabbitmrr.workers.dev/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({input:text,lang})});
        if(!res.ok) throw new Error('Network error');
        const data=await res.json();
        $('chat').insertAdjacentHTML('beforeend', `<div class="bubble"><strong>AI:</strong> ${data.reply.replace(/</g,'&lt;').replace(/\n/g,'<br/>')}</div>`);
      }catch(e){
        $('chat').insertAdjacentHTML('beforeend', `<div class="bubble">通信に失敗しました。しばらくしてからお試しください。</div>`);
      }finally{
        $('sendBtn').disabled=false; $('sendBtn').textContent= lang==='ja' ? 'AIに渡す' : 'Send to AI';
      }
    }
    $('sendBtn').addEventListener('click', sendMessage);
  </script>
</body>
</html>
